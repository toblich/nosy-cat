#!/bin/bash

# Enable bash 'strict mode' (http://redsymbol.net/articles/unofficial-bash-strict-mode/)
set -euo pipefail
IFS=$'\n\t'

DIR="$(cd -P "$(dirname "${BASH_SOURCE[0]}")" && pwd)"

function send-span {
  TEMPLATE=$1
  NOW=`date "+%s"`000000 # Add 3 zeros to simulate millisecond precision
  SPAN=`echo -n "$TEMPLATE" | sed -E s/"timestamp":[\d]+/"timestamp":$NOW/g`
  echo $SPAN | json_pp
  curl -X POST localhost:3000/api/v2/spans -H 'Content-Type: application/json' -d $SPAN
}

function send-healthy-span {
  send-span '[{"traceId":"f2f05a4babfd3246","parentId":"4b9c09840d6fcb9e","id":"beecbc19f79297f0","name":"query postgres","kind":"CLIENT","timestamp":1581280042864000,"duration":42588,"localEndpoint":{"serviceName":"iam"},"remoteEndpoint":{"serviceName":"postgres","port":5432}},{"traceId":"f2f05a4babfd3246","parentId":"f2f05a4babfd3246","id":"4b9c09840d6fcb9e","name":"get","kind":"SERVER","timestamp":1581280042659000,"duration":336807,"localEndpoint":{"serviceName":"iam","ipv4":"172.25.0.9"},"tags":{"http.path":"/login","http.status_code":"200"},"shared":true},{"traceId":"34f0a4af605f51b1","parentId":"e307420db1af7589","id":"23237140f557a7d7","name":"query postgres","kind":"CLIENT","timestamp":1581280043156000,"duration":184618,"localEndpoint":{"serviceName":"iam"},"remoteEndpoint":{"serviceName":"postgres","port":5432}},{"traceId":"34f0a4af605f51b1","parentId":"34f0a4af605f51b1","id":"e307420db1af7589","name":"get","kind":"SERVER","timestamp":1581280043146000,"duration":208307,"localEndpoint":{"serviceName":"iam","ipv4":"172.25.0.9"},"tags":{"http.path":"/login","http.status_code":"200"},"shared":true},{"traceId":"8b74f75d6068d5e7","parentId":"13f361a8f1041b1b","id":"67964c33e032b0aa","name":"query postgres","kind":"CLIENT","timestamp":1581280043438000,"duration":110310,"localEndpoint":{"serviceName":"iam"},"remoteEndpoint":{"serviceName":"postgres","port":5432}},{"traceId":"8b74f75d6068d5e7","parentId":"8b74f75d6068d5e7","id":"13f361a8f1041b1b","name":"get","kind":"SERVER","timestamp":1581280043323000,"duration":246724,"localEndpoint":{"serviceName":"iam","ipv4":"172.25.0.9"},"tags":{"http.path":"/login","http.status_code":"200"},"shared":true},{"traceId":"69289afd5de1be25","parentId":"29d8e9d44ef2d1d2","id":"8898dda63f3a2c15","name":"query postgres","kind":"CLIENT","timestamp":1581280043440000,"duration":132942,"localEndpoint":{"serviceName":"iam"},"remoteEndpoint":{"serviceName":"postgres","port":5432}},{"traceId":"69289afd5de1be25","parentId":"69289afd5de1be25","id":"29d8e9d44ef2d1d2","name":"get","kind":"SERVER","timestamp":1581280043320000,"duration":257339,"localEndpoint":{"serviceName":"iam","ipv4":"172.25.0.9"},"tags":{"http.path":"/login","http.status_code":"200"},"shared":true},{"traceId":"7147a8b88504171c","parentId":"91a64702ad28bb59","id":"405be1289c99297d","name":"query postgres","kind":"CLIENT","timestamp":1581280043423000,"duration":156312,"localEndpoint":{"serviceName":"iam"},"remoteEndpoint":{"serviceName":"postgres","port":5432}},{"traceId":"7147a8b88504171c","parentId":"7147a8b88504171c","id":"91a64702ad28bb59","name":"get","kind":"SERVER","timestamp":1581280043310000,"duration":273664,"localEndpoint":{"serviceName":"iam","ipv4":"172.25.0.9"},"tags":{"http.path":"/login","http.status_code":"200"},"shared":true},{"traceId":"b5c940cff37eb110","parentId":"02870f4eda1d53a3","id":"a84c656fa9fa6f07","name":"query postgres","kind":"CLIENT","timestamp":1581280043538000,"duration":47513,"localEndpoint":{"serviceName":"iam"},"remoteEndpoint":{"serviceName":"postgres","port":5432}},{"traceId":"b5c940cff37eb110","parentId":"b5c940cff37eb110","id":"02870f4eda1d53a3","name":"get","kind":"SERVER","timestamp":1581280043329000,"duration":262022,"localEndpoint":{"serviceName":"iam","ipv4":"172.25.0.9"},"tags":{"http.path":"/login","http.status_code":"200"},"shared":true},{"traceId":"a14e82f42a1b99de","parentId":"b89e6e400818019a","id":"36939a8619e1941f","name":"query postgres","kind":"CLIENT","timestamp":1581280043516000,"duration":76347,"localEndpoint":{"serviceName":"iam"},"remoteEndpoint":{"serviceName":"postgres","port":5432}},{"traceId":"a14e82f42a1b99de","parentId":"a14e82f42a1b99de","id":"b89e6e400818019a","name":"get","kind":"SERVER","timestamp":1581280043316000,"duration":279113,"localEndpoint":{"serviceName":"iam","ipv4":"172.25.0.9"},"tags":{"http.path":"/login","http.status_code":"200"},"shared":true},{"traceId":"1ee06cd80f2b8bff","parentId":"b3055136d8aa754e","id":"e6495a3088d54769","name":"query postgres","kind":"CLIENT","timestamp":1581280043535000,"duration":62067,"localEndpoint":{"serviceName":"iam"},"remoteEndpoint":{"serviceName":"postgres","port":5432}},{"traceId":"1ee06cd80f2b8bff","parentId":"1ee06cd80f2b8bff","id":"b3055136d8aa754e","name":"get","kind":"SERVER","timestamp":1581280043332000,"duration":265784,"localEndpoint":{"serviceName":"iam","ipv4":"172.25.0.9"},"tags":{"http.path":"/login","http.status_code":"200"},"shared":true},{"traceId":"e06524409ba5ad5d","parentId":"992aa0df6213adf9","id":"9ad1a7e4dad55e8c","name":"query postgres","kind":"CLIENT","timestamp":1581280043531000,"duration":71217,"localEndpoint":{"serviceName":"iam"},"remoteEndpoint":{"serviceName":"postgres","port":5432}},{"traceId":"e06524409ba5ad5d","parentId":"e06524409ba5ad5d","id":"992aa0df6213adf9","name":"get","kind":"SERVER","timestamp":1581280043195000,"duration":402775,"localEndpoint":{"serviceName":"iam","ipv4":"172.25.0.9"},"tags":{"http.path":"/login","http.status_code":"200"},"shared":true},{"traceId":"3e63866b4fcbebbe","parentId":"07a3b70e11f23ce2","id":"e80819fab90be9ab","name":"query postgres","kind":"CLIENT","timestamp":1581280043536000,"duration":69687,"localEndpoint":{"serviceName":"iam"},"remoteEndpoint":{"serviceName":"postgres","port":5432}},{"traceId":"3e63866b4fcbebbe","parentId":"3e63866b4fcbebbe","id":"07a3b70e11f23ce2","name":"get","kind":"SERVER","timestamp":1581280043326000,"duration":281496,"localEndpoint":{"serviceName":"iam","ipv4":"172.25.0.9"},"tags":{"http.path":"/login","http.status_code":"200"},"shared":true}]'
}

function send-broken-span {
  send-span '[{"traceId":"bbeaf89c4afb6a7f","parentId":"018f5e6139aa7028","id":"856d1efd583c28a5","name":"get","kind":"CLIENT","timestamp":1581280055365000,"duration":31643,"localEndpoint":{"serviceName":"xapi"},"remoteEndpoint":{"serviceName":"redis","port":"6379"}},{"traceId":"8a9232e490d3b047","parentId":"583e34d4c70308f9","id":"2b55ea85a6490da3","name":"get","kind":"CLIENT","timestamp":1581280055367000,"duration":32943,"localEndpoint":{"serviceName":"xapi"},"remoteEndpoint":{"serviceName":"redis","port":"6379"}},{"traceId":"3bc7585b29eded8a","parentId":"f94b4afd854fe197","id":"65913aaa55cf1cae","name":"get","kind":"CLIENT","timestamp":1581280055368000,"duration":32658,"localEndpoint":{"serviceName":"xapi"},"remoteEndpoint":{"serviceName":"redis","port":"6379"}},{"traceId":"04fda65da984fdf6","parentId":"47b825fc6b9d8113","id":"f5465a9fe3a90e14","name":"get","kind":"CLIENT","timestamp":1581280055369000,"duration":32004,"localEndpoint":{"serviceName":"xapi"},"remoteEndpoint":{"serviceName":"redis","port":"6379"}},{"traceId":"d1e4e61734655c29","parentId":"174fa8e8dd54a5ea","id":"c2beb9bae28fe884","name":"get","kind":"CLIENT","timestamp":1581280055391000,"duration":10577,"localEndpoint":{"serviceName":"xapi"},"remoteEndpoint":{"serviceName":"redis","port":"6379"}},{"traceId":"717b7ea0385d913e","parentId":"e06245856f924bb5","id":"1ef6866055ed5190","name":"get","kind":"CLIENT","timestamp":1581280055392000,"duration":9473,"localEndpoint":{"serviceName":"xapi"},"remoteEndpoint":{"serviceName":"redis","port":"6379"}},{"traceId":"bbeaf89c4afb6a7f","id":"bbeaf89c4afb6a7f","name":"get","kind":"SERVER","timestamp":1581280055282000,"duration":124072,"localEndpoint":{"serviceName":"xapi","ipv4":"172.25.0.4"},"tags":{"http.path":"/authorize","http.status_code":"503","error":"503"}},{"traceId":"8a9232e490d3b047","id":"8a9232e490d3b047","name":"get","kind":"SERVER","timestamp":1581280055284000,"duration":122134,"localEndpoint":{"serviceName":"xapi","ipv4":"172.25.0.4"},"tags":{"http.path":"/authorize","http.status_code":"503","error":"503"}},{"traceId":"3bc7585b29eded8a","id":"3bc7585b29eded8a","name":"get","kind":"SERVER","timestamp":1581280055286000,"duration":120897,"localEndpoint":{"serviceName":"xapi","ipv4":"172.25.0.4"},"tags":{"http.path":"/authorize","http.status_code":"503","error":"503"}},{"traceId":"04fda65da984fdf6","id":"04fda65da984fdf6","name":"get","kind":"SERVER","timestamp":1581280055289000,"duration":118564,"localEndpoint":{"serviceName":"xapi","ipv4":"172.25.0.4"},"tags":{"http.path":"/authorize","http.status_code":"503","error":"503"}},{"traceId":"d1e4e61734655c29","id":"d1e4e61734655c29","name":"get","kind":"SERVER","timestamp":1581280055290000,"duration":117518,"localEndpoint":{"serviceName":"xapi","ipv4":"172.25.0.4"},"tags":{"http.path":"/authorize","http.status_code":"503","error":"503"}},{"traceId":"717b7ea0385d913e","id":"717b7ea0385d913e","name":"get","kind":"SERVER","timestamp":1581280055291000,"duration":116632,"localEndpoint":{"serviceName":"xapi","ipv4":"172.25.0.4"},"tags":{"http.path":"/authorize","http.status_code":"503","error":"503"}},{"traceId":"4aaf369f74a5b119","parentId":"4aaf369f74a5b119","id":"f14cb86ea3c803ce","name":"get","kind":"CLIENT","timestamp":1581280055293000,"duration":117636,"localEndpoint":{"serviceName":"xapi"},"remoteEndpoint":{"serviceName":"iam"},"tags":{"http.path":"/authorize","http.status_code":"503","error":"503"}},{"traceId":"75ce7518a2102b63","parentId":"75ce7518a2102b63","id":"b058302e8ee49a28","name":"get","kind":"CLIENT","timestamp":1581280055295000,"duration":117469,"localEndpoint":{"serviceName":"xapi"},"remoteEndpoint":{"serviceName":"iam"},"tags":{"http.path":"/authorize","http.status_code":"503","error":"503"}},{"traceId":"f1eadbd61f14c2b5","parentId":"f1eadbd61f14c2b5","id":"eaad877cb87b6c03","name":"get","kind":"CLIENT","timestamp":1581280055296000,"duration":117527,"localEndpoint":{"serviceName":"xapi"},"remoteEndpoint":{"serviceName":"iam"},"tags":{"http.path":"/authorize","http.status_code":"503","error":"503"}},{"traceId":"4aaf369f74a5b119","parentId":"f14cb86ea3c803ce","id":"80569ddadf700f08","name":"get","kind":"CLIENT","timestamp":1581280055411000,"duration":4730,"localEndpoint":{"serviceName":"xapi"},"remoteEndpoint":{"serviceName":"redis","port":"6379"}},{"traceId":"75ce7518a2102b63","parentId":"b058302e8ee49a28","id":"0c77118fd0979158","name":"get","kind":"CLIENT","timestamp":1581280055412000,"duration":4167,"localEndpoint":{"serviceName":"xapi"},"remoteEndpoint":{"serviceName":"redis","port":"6379"}},{"traceId":"f1eadbd61f14c2b5","parentId":"eaad877cb87b6c03","id":"bf24205a660c02c7","name":"get","kind":"CLIENT","timestamp":1581280055415000,"duration":2812,"localEndpoint":{"serviceName":"xapi"},"remoteEndpoint":{"serviceName":"redis","port":"6379"}},{"traceId":"4aaf369f74a5b119","id":"4aaf369f74a5b119","name":"get","kind":"SERVER","timestamp":1581280055293000,"duration":129618,"localEndpoint":{"serviceName":"xapi","ipv4":"172.25.0.4"},"tags":{"http.path":"/authorize","http.status_code":"503","error":"503"}},{"traceId":"75ce7518a2102b63","id":"75ce7518a2102b63","name":"get","kind":"SERVER","timestamp":1581280055294000,"duration":128970,"localEndpoint":{"serviceName":"xapi","ipv4":"172.25.0.4"},"tags":{"http.path":"/authorize","http.status_code":"503","error":"503"}},{"traceId":"f1eadbd61f14c2b5","id":"f1eadbd61f14c2b5","name":"get","kind":"SERVER","timestamp":1581280055296000,"duration":128739,"localEndpoint":{"serviceName":"xapi","ipv4":"172.25.0.4"},"tags":{"http.path":"/authorize","http.status_code":"503","error":"503"}}]'
}

PD_URI=test docker-compose up -d # TODO

sleep 5

docker-compose run pulsar ./bin/pulsar-client --url pulsar://pulsar:6650 consume -n 1 -s e2e-test -t Shared component-alerts

# docc run pulsar ./bin/pulsar-client --url pulsar://pulsar:6650 consume -n 1 -s e2e-test -t Shared component-alerts

# OK:
# curl localhost:3000/api/v2/spans -H 'Content-Type: application/json' -d '[{"traceId":"f2f05a4babfd3246","parentId":"4b9c09840d6fcb9e","id":"beecbc19f79297f0","name":"query postgres","kind":"CLIENT","timestamp":1581280042864000,"duration":42588,"localEndpoint":{"serviceName":"iam"},"remoteEndpoint":{"serviceName":"postgres","port":5432}},{"traceId":"f2f05a4babfd3246","parentId":"f2f05a4babfd3246","id":"4b9c09840d6fcb9e","name":"get","kind":"SERVER","timestamp":1581280042659000,"duration":336807,"localEndpoint":{"serviceName":"iam","ipv4":"172.25.0.9"},"tags":{"http.path":"/login","http.status_code":"200"},"shared":true},{"traceId":"34f0a4af605f51b1","parentId":"e307420db1af7589","id":"23237140f557a7d7","name":"query postgres","kind":"CLIENT","timestamp":1581280043156000,"duration":184618,"localEndpoint":{"serviceName":"iam"},"remoteEndpoint":{"serviceName":"postgres","port":5432}},{"traceId":"34f0a4af605f51b1","parentId":"34f0a4af605f51b1","id":"e307420db1af7589","name":"get","kind":"SERVER","timestamp":1581280043146000,"duration":208307,"localEndpoint":{"serviceName":"iam","ipv4":"172.25.0.9"},"tags":{"http.path":"/login","http.status_code":"200"},"shared":true},{"traceId":"8b74f75d6068d5e7","parentId":"13f361a8f1041b1b","id":"67964c33e032b0aa","name":"query postgres","kind":"CLIENT","timestamp":1581280043438000,"duration":110310,"localEndpoint":{"serviceName":"iam"},"remoteEndpoint":{"serviceName":"postgres","port":5432}},{"traceId":"8b74f75d6068d5e7","parentId":"8b74f75d6068d5e7","id":"13f361a8f1041b1b","name":"get","kind":"SERVER","timestamp":1581280043323000,"duration":246724,"localEndpoint":{"serviceName":"iam","ipv4":"172.25.0.9"},"tags":{"http.path":"/login","http.status_code":"200"},"shared":true},{"traceId":"69289afd5de1be25","parentId":"29d8e9d44ef2d1d2","id":"8898dda63f3a2c15","name":"query postgres","kind":"CLIENT","timestamp":1581280043440000,"duration":132942,"localEndpoint":{"serviceName":"iam"},"remoteEndpoint":{"serviceName":"postgres","port":5432}},{"traceId":"69289afd5de1be25","parentId":"69289afd5de1be25","id":"29d8e9d44ef2d1d2","name":"get","kind":"SERVER","timestamp":1581280043320000,"duration":257339,"localEndpoint":{"serviceName":"iam","ipv4":"172.25.0.9"},"tags":{"http.path":"/login","http.status_code":"200"},"shared":true},{"traceId":"7147a8b88504171c","parentId":"91a64702ad28bb59","id":"405be1289c99297d","name":"query postgres","kind":"CLIENT","timestamp":1581280043423000,"duration":156312,"localEndpoint":{"serviceName":"iam"},"remoteEndpoint":{"serviceName":"postgres","port":5432}},{"traceId":"7147a8b88504171c","parentId":"7147a8b88504171c","id":"91a64702ad28bb59","name":"get","kind":"SERVER","timestamp":1581280043310000,"duration":273664,"localEndpoint":{"serviceName":"iam","ipv4":"172.25.0.9"},"tags":{"http.path":"/login","http.status_code":"200"},"shared":true},{"traceId":"b5c940cff37eb110","parentId":"02870f4eda1d53a3","id":"a84c656fa9fa6f07","name":"query postgres","kind":"CLIENT","timestamp":1581280043538000,"duration":47513,"localEndpoint":{"serviceName":"iam"},"remoteEndpoint":{"serviceName":"postgres","port":5432}},{"traceId":"b5c940cff37eb110","parentId":"b5c940cff37eb110","id":"02870f4eda1d53a3","name":"get","kind":"SERVER","timestamp":1581280043329000,"duration":262022,"localEndpoint":{"serviceName":"iam","ipv4":"172.25.0.9"},"tags":{"http.path":"/login","http.status_code":"200"},"shared":true},{"traceId":"a14e82f42a1b99de","parentId":"b89e6e400818019a","id":"36939a8619e1941f","name":"query postgres","kind":"CLIENT","timestamp":1581280043516000,"duration":76347,"localEndpoint":{"serviceName":"iam"},"remoteEndpoint":{"serviceName":"postgres","port":5432}},{"traceId":"a14e82f42a1b99de","parentId":"a14e82f42a1b99de","id":"b89e6e400818019a","name":"get","kind":"SERVER","timestamp":1581280043316000,"duration":279113,"localEndpoint":{"serviceName":"iam","ipv4":"172.25.0.9"},"tags":{"http.path":"/login","http.status_code":"200"},"shared":true},{"traceId":"1ee06cd80f2b8bff","parentId":"b3055136d8aa754e","id":"e6495a3088d54769","name":"query postgres","kind":"CLIENT","timestamp":1581280043535000,"duration":62067,"localEndpoint":{"serviceName":"iam"},"remoteEndpoint":{"serviceName":"postgres","port":5432}},{"traceId":"1ee06cd80f2b8bff","parentId":"1ee06cd80f2b8bff","id":"b3055136d8aa754e","name":"get","kind":"SERVER","timestamp":1581280043332000,"duration":265784,"localEndpoint":{"serviceName":"iam","ipv4":"172.25.0.9"},"tags":{"http.path":"/login","http.status_code":"200"},"shared":true},{"traceId":"e06524409ba5ad5d","parentId":"992aa0df6213adf9","id":"9ad1a7e4dad55e8c","name":"query postgres","kind":"CLIENT","timestamp":1581280043531000,"duration":71217,"localEndpoint":{"serviceName":"iam"},"remoteEndpoint":{"serviceName":"postgres","port":5432}},{"traceId":"e06524409ba5ad5d","parentId":"e06524409ba5ad5d","id":"992aa0df6213adf9","name":"get","kind":"SERVER","timestamp":1581280043195000,"duration":402775,"localEndpoint":{"serviceName":"iam","ipv4":"172.25.0.9"},"tags":{"http.path":"/login","http.status_code":"200"},"shared":true},{"traceId":"3e63866b4fcbebbe","parentId":"07a3b70e11f23ce2","id":"e80819fab90be9ab","name":"query postgres","kind":"CLIENT","timestamp":1581280043536000,"duration":69687,"localEndpoint":{"serviceName":"iam"},"remoteEndpoint":{"serviceName":"postgres","port":5432}},{"traceId":"3e63866b4fcbebbe","parentId":"3e63866b4fcbebbe","id":"07a3b70e11f23ce2","name":"get","kind":"SERVER","timestamp":1581280043326000,"duration":281496,"localEndpoint":{"serviceName":"iam","ipv4":"172.25.0.9"},"tags":{"http.path":"/login","http.status_code":"200"},"shared":true}]'


# BAD
# curl localhost:3000/api/v2/spans -H 'Content-Type: application/json' -d '[{"traceId":"bbeaf89c4afb6a7f","parentId":"018f5e6139aa7028","id":"856d1efd583c28a5","name":"get","kind":"CLIENT","timestamp":1581280055365000,"duration":31643,"localEndpoint":{"serviceName":"xapi"},"remoteEndpoint":{"serviceName":"redis","port":"6379"}},{"traceId":"8a9232e490d3b047","parentId":"583e34d4c70308f9","id":"2b55ea85a6490da3","name":"get","kind":"CLIENT","timestamp":1581280055367000,"duration":32943,"localEndpoint":{"serviceName":"xapi"},"remoteEndpoint":{"serviceName":"redis","port":"6379"}},{"traceId":"3bc7585b29eded8a","parentId":"f94b4afd854fe197","id":"65913aaa55cf1cae","name":"get","kind":"CLIENT","timestamp":1581280055368000,"duration":32658,"localEndpoint":{"serviceName":"xapi"},"remoteEndpoint":{"serviceName":"redis","port":"6379"}},{"traceId":"04fda65da984fdf6","parentId":"47b825fc6b9d8113","id":"f5465a9fe3a90e14","name":"get","kind":"CLIENT","timestamp":1581280055369000,"duration":32004,"localEndpoint":{"serviceName":"xapi"},"remoteEndpoint":{"serviceName":"redis","port":"6379"}},{"traceId":"d1e4e61734655c29","parentId":"174fa8e8dd54a5ea","id":"c2beb9bae28fe884","name":"get","kind":"CLIENT","timestamp":1581280055391000,"duration":10577,"localEndpoint":{"serviceName":"xapi"},"remoteEndpoint":{"serviceName":"redis","port":"6379"}},{"traceId":"717b7ea0385d913e","parentId":"e06245856f924bb5","id":"1ef6866055ed5190","name":"get","kind":"CLIENT","timestamp":1581280055392000,"duration":9473,"localEndpoint":{"serviceName":"xapi"},"remoteEndpoint":{"serviceName":"redis","port":"6379"}},{"traceId":"bbeaf89c4afb6a7f","id":"bbeaf89c4afb6a7f","name":"get","kind":"SERVER","timestamp":1581280055282000,"duration":124072,"localEndpoint":{"serviceName":"xapi","ipv4":"172.25.0.4"},"tags":{"http.path":"/authorize","http.status_code":"503","error":"503"}},{"traceId":"8a9232e490d3b047","id":"8a9232e490d3b047","name":"get","kind":"SERVER","timestamp":1581280055284000,"duration":122134,"localEndpoint":{"serviceName":"xapi","ipv4":"172.25.0.4"},"tags":{"http.path":"/authorize","http.status_code":"503","error":"503"}},{"traceId":"3bc7585b29eded8a","id":"3bc7585b29eded8a","name":"get","kind":"SERVER","timestamp":1581280055286000,"duration":120897,"localEndpoint":{"serviceName":"xapi","ipv4":"172.25.0.4"},"tags":{"http.path":"/authorize","http.status_code":"503","error":"503"}},{"traceId":"04fda65da984fdf6","id":"04fda65da984fdf6","name":"get","kind":"SERVER","timestamp":1581280055289000,"duration":118564,"localEndpoint":{"serviceName":"xapi","ipv4":"172.25.0.4"},"tags":{"http.path":"/authorize","http.status_code":"503","error":"503"}},{"traceId":"d1e4e61734655c29","id":"d1e4e61734655c29","name":"get","kind":"SERVER","timestamp":1581280055290000,"duration":117518,"localEndpoint":{"serviceName":"xapi","ipv4":"172.25.0.4"},"tags":{"http.path":"/authorize","http.status_code":"503","error":"503"}},{"traceId":"717b7ea0385d913e","id":"717b7ea0385d913e","name":"get","kind":"SERVER","timestamp":1581280055291000,"duration":116632,"localEndpoint":{"serviceName":"xapi","ipv4":"172.25.0.4"},"tags":{"http.path":"/authorize","http.status_code":"503","error":"503"}},{"traceId":"4aaf369f74a5b119","parentId":"4aaf369f74a5b119","id":"f14cb86ea3c803ce","name":"get","kind":"CLIENT","timestamp":1581280055293000,"duration":117636,"localEndpoint":{"serviceName":"xapi"},"remoteEndpoint":{"serviceName":"iam"},"tags":{"http.path":"/authorize","http.status_code":"503","error":"503"}},{"traceId":"75ce7518a2102b63","parentId":"75ce7518a2102b63","id":"b058302e8ee49a28","name":"get","kind":"CLIENT","timestamp":1581280055295000,"duration":117469,"localEndpoint":{"serviceName":"xapi"},"remoteEndpoint":{"serviceName":"iam"},"tags":{"http.path":"/authorize","http.status_code":"503","error":"503"}},{"traceId":"f1eadbd61f14c2b5","parentId":"f1eadbd61f14c2b5","id":"eaad877cb87b6c03","name":"get","kind":"CLIENT","timestamp":1581280055296000,"duration":117527,"localEndpoint":{"serviceName":"xapi"},"remoteEndpoint":{"serviceName":"iam"},"tags":{"http.path":"/authorize","http.status_code":"503","error":"503"}},{"traceId":"4aaf369f74a5b119","parentId":"f14cb86ea3c803ce","id":"80569ddadf700f08","name":"get","kind":"CLIENT","timestamp":1581280055411000,"duration":4730,"localEndpoint":{"serviceName":"xapi"},"remoteEndpoint":{"serviceName":"redis","port":"6379"}},{"traceId":"75ce7518a2102b63","parentId":"b058302e8ee49a28","id":"0c77118fd0979158","name":"get","kind":"CLIENT","timestamp":1581280055412000,"duration":4167,"localEndpoint":{"serviceName":"xapi"},"remoteEndpoint":{"serviceName":"redis","port":"6379"}},{"traceId":"f1eadbd61f14c2b5","parentId":"eaad877cb87b6c03","id":"bf24205a660c02c7","name":"get","kind":"CLIENT","timestamp":1581280055415000,"duration":2812,"localEndpoint":{"serviceName":"xapi"},"remoteEndpoint":{"serviceName":"redis","port":"6379"}},{"traceId":"4aaf369f74a5b119","id":"4aaf369f74a5b119","name":"get","kind":"SERVER","timestamp":1581280055293000,"duration":129618,"localEndpoint":{"serviceName":"xapi","ipv4":"172.25.0.4"},"tags":{"http.path":"/authorize","http.status_code":"503","error":"503"}},{"traceId":"75ce7518a2102b63","id":"75ce7518a2102b63","name":"get","kind":"SERVER","timestamp":1581280055294000,"duration":128970,"localEndpoint":{"serviceName":"xapi","ipv4":"172.25.0.4"},"tags":{"http.path":"/authorize","http.status_code":"503","error":"503"}},{"traceId":"f1eadbd61f14c2b5","id":"f1eadbd61f14c2b5","name":"get","kind":"SERVER","timestamp":1581280055296000,"duration":128739,"localEndpoint":{"serviceName":"xapi","ipv4":"172.25.0.4"},"tags":{"http.path":"/authorize","http.status_code":"503","error":"503"}}]'
